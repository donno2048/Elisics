<phyphox version="1.10" locale="en">
  <title>Audio Spectrum</title>
  <category>Acoustics</category>
  <icon format="base64">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</icon>
  <description>
            Display the frequency spectrum of an audio signal.

            This experiment records audio from the microphone and calculates its frequency spectrum through a Fourier transformation (FFT). If you only have a single tone with a single frequency, you might get more precise results from the "autocorrelation" audio experiment.
    </description>
  <link label="Wiki">http://phyphox.org/wiki/index.php?title=Experiment:_Audio_Spectrum</link>
    <data-containers>
    <container size="32768">recording</container>
    <container>rate</container>
    <container>rate/2</container>
    <container size="32768">recording_subrange</container>
    <container>recording_length</container>
    <container init="2048">samples</container>
    <container>actual_samples/2</container>
    <container>actual_samples/2+1</container>
    <container>actual_samples+1</container>
    <container>actual_samples</container>
    <container>subrange_start</container>
    <container>period</container>
    <container size="32768">time</container>
    <container size="32769">frequency</container>
    <container size="32768">fftX</container>
    <container size="32768">fftY</container>
    <container size="16384">halfFrequency</container>
    <container size="16384">halfFFTtempX</container>
    <container size="16384">halfFFTtempY</container>
    <container size="16384">fft</container>
    <container size="0">f0</container>
    <container size="0">t</container>
    <container>ratio</container>
    <container static="true">log2</container>
    <container>logRatio</container>
    <container>log2Ratio</container>
    <container>cents</container>
    <container>semitones</container>
    <container>semitonesRound</container>
    <container>semitonesDiff</container>
    <container>centsDiff</container>
    <container size="1">resolutionRatio</container>
    <container size="256">timeline</container>
    <container size="4096">reducedf</container>
    <container size="4096">reducedfft</container>
    <container size="256">subf</container>
    <container size="256">subfft</container>
    <container size="32768">tmap</container>
    <container size="32768">fmap</container>
    <container size="32768">fftmap</container>
    <container init="0">wnamplitude</container>
  </data-containers>
  <input>
    <audio>
      <output>recording</output>
      <output component="rate">rate</output>
    </audio>
  </input>
  <output>
    <audio loop="true">
      <noise>
        <input parameter="amplitude">wnamplitude</input>
      </noise>
    </audio>
  </output>
  <views>
    <view label="Spectrum">
      <value label="Peak-Frequency" unit="Hz">
        <input>f0</input>
      </value>
      <separator height="1"/>
      <value label="Musical note">
        <input>semitonesRound</input>
        <map max="-25">Low</map>
        <map max="-24">A2</map>
        <map max="-23">A#2 / Bb2</map>
        <map max="-22">B2</map>
        <map max="-21">C3</map>
        <map max="-20">C#3 / Db3</map>
        <map max="-19">D3</map>
        <map max="-18">D#3 / Eb3</map>
        <map max="-17">E3</map>
        <map max="-16">F3</map>
        <map max="-15">F#3 / Gb3</map>
        <map max="-14">G3</map>
        <map max="-13">G#3 / Ab3</map>
        <map max="-12">A3</map>
        <map max="-11">A#3 / Bb3</map>
        <map max="-10">B3</map>
        <map max="-9">C4</map>
        <map max="-8">C#4 / Db4</map>
        <map max="-7">D4</map>
        <map max="-6">D#4 / Eb4</map>
        <map max="-5">E4</map>
        <map max="-4">F4</map>
        <map max="-3">F#4 / Gb4</map>
        <map max="-2">G4</map>
        <map max="-1">G#4 / Ab4</map>
        <map max="0">A4</map>
        <map max="1">A#4 / Bb4</map>
        <map max="2">B4</map>
        <map max="3">C5</map>
        <map max="4">C#5 / Db5</map>
        <map max="5">D5</map>
        <map max="6">D#5 / Eb5</map>
        <map max="7">E5</map>
        <map max="8">F5</map>
        <map max="9">F#5 / Gb5</map>
        <map max="10">G5</map>
        <map max="11">G#5 / Ab5</map>
        <map max="12">A5</map>
        <map max="13">A#5 / Bb5</map>
        <map max="14">B5</map>
        <map max="15">C6</map>
        <map max="16">C#6 / Db6</map>
        <map max="17">D6</map>
        <map max="18">D#6 / Eb6</map>
        <map max="19">E6</map>
        <map max="20">F6</map>
        <map max="21">F#6 / Gb6</map>
        <map max="22">G6</map>
        <map max="23">G#6 / Ab6</map>
        <map max="24">A6</map>
        <map max="25">A#6 / Bb6</map>
        <map max="26">B6</map>
        <map max="27">C7</map>
        <map max="28">C#7 / Db7</map>
        <map max="29">D7</map>
        <map max="30">D#7 / Eb7</map>
        <map max="31">E7</map>
        <map max="32">F7</map>
        <map max="33">F#7 / Gb7</map>
        <map max="34">G7</map>
        <map max="35">G#7 / Ab7</map>
        <map min="35">High</map>
      </value>
      <value label="Cents from note">
        <input>centsDiff</input>
      </value>
      <separator height="1"/>
      <graph label="Fourier Transform" logX="true" logY="true" labelX="Frequency" unitX="Hz" labelY="FFT Mag" unitY="a.u.">
        <input axis="x">halfFrequency</input>
        <input axis="y">fft</input>
      </graph>
      <separator height="1" precision="0"/>
      <value label="Samples used">
        <input>actual_samples</input>
      </value>
      <value label="Period used" unit="ms" precision="2" factor="1000">
        <input>period</input>
      </value>
    </view>
    <view label="History">
      <graph label="Fourier Transform" logZ="true" labelX="Frequency" unitX="Hz" labelY="Time" unitY="s" labelZ="FFT Mag" unitZ="a.u." aspectRatio="1" style="map" mapWidth="256" partialUpdate="true">
        <input axis="x">fmap</input>
        <input axis="y">tmap</input>
        <input axis="z">fftmap</input>
      </graph>
      <graph label="History" labelX="Time" unitX="s" labelY="Peak-Frequency" unitY="Hz" partialUpdate="true" style="dots">
        <input axis="x">t</input>
        <input axis="y">f0</input>
      </graph>
    </view>
    <view label="Settings">
      <info label="Below you can set the number of samples used for the Fourier transform. More samples means slower updates, but higher spectral resolution."/>
      <value label="Samples" precision="0">
        <input>samples</input>
      </value>
      <separator height="0.5"/>
      <button label="2048">
        <input type="value">2048</input>
        <output>samples</output>
      </button>
      <button label="4096">
        <input type="value">4096</input>
        <output>samples</output>
      </button>
      <button label="8192">
        <input type="value">8192</input>
        <output>samples</output>
      </button>
      <button label="16384">
        <input type="value">16384</input>
        <output>samples</output>
      </button>
      <button label="32768">
        <input type="value">32768</input>
        <output>samples</output>
      </button>
      <separator height="0.5"/>
      <separator color="white"/>
      <separator height="0.5"/>
      <info label="White noise generator. (Can be loud. Please reduce your playback volume first.)"/>
      <button label="Off">
        <input type="value">0</input>
        <output>wnamplitude</output>
      </button>
      <button label="On">
        <input type="value">1</input>
        <output>wnamplitude</output>
      </button>
      <value label="Status">
        <input>wnamplitude</input>
        <map max="0">Off</map>
        <map min="1">On</map>
      </value>
    </view>
    <view label="Raw data">
      <graph label="Recording" labelX="t" unitX="s" labelY="Amplitude" unitY="a.u.">
        <input axis="x">time</input>
        <input axis="y">recording_subrange</input>
      </graph>
    </view>
  </views>
  <analysis sleep="0.05" dynamicSleep="period">
    <timer>
      <output clear="false">t</output>
    </timer>
    <const>
      <input as="value" clear="false">t</input>
      <input as="length" type="value">256</input>
      <output>timeline</output>
    </const>
    <count>
      <input clear="false">recording</input>
      <output>recording_length</output>
    </count>
    <subtract>
      <input>recording_length</input>
      <input clear="false">samples</input>
      <output>subrange_start</output>
    </subtract>
    <subrange>
      <input clear="false" as="from">subrange_start</input>
      <input as="in" clear="false">recording</input>
      <output>recording_subrange</output>
    </subrange>
    <count>
      <input clear="false">recording_subrange</input>
      <output>actual_samples</output>
    </count>
    <add>
      <input clear="false">actual_samples</input>
      <input type="value">1</input>
      <output>actual_samples+1</output>
    </add>
    <divide>
      <input clear="false">actual_samples</input>
      <input type="value">2</input>
      <output>actual_samples/2</output>
    </divide>
    <add>
      <input clear="false">actual_samples/2</input>
      <input type="value">1</input>
      <output>actual_samples/2+1</output>
    </add>
    <divide>
      <input clear="false">actual_samples</input>
      <input clear="false">rate</input>
      <output>period</output>
    </divide>
    <divide>
      <input clear="false">rate</input>
      <input type="value">2</input>
      <output>rate/2</output>
    </divide>
    <ramp>
      <input as="start" type="value">0</input>
      <input as="stop" clear="false">period</input>
      <input as="length" clear="false">actual_samples+1</input>
      <output>time</output>
    </ramp>
    <ramp>
      <input as="start" type="value">0</input>
      <input as="stop" clear="false">rate/2</input>
      <input as="length" clear="false">actual_samples/2+1</input>
      <output>frequency</output>
    </ramp>
    <fft>
      <input clear="false">recording_subrange</input>
      <output as="re">fftX</output>
      <output as="im">fftY</output>
    </fft>
    <subrange>
      <input type="value" as="from">1</input>
      <input clear="false" as="to">actual_samples/2</input>
      <input as="in">frequency</input>
      <input as="in">fftX</input>
      <input as="in">fftY</input>
      <output>halfFrequency</output>
      <output>halfFFTtempX</output>
      <output>halfFFTtempY</output>
    </subrange>
    <formula formula="sqrt([1_]*[1_]+[2_]*[2_])">
      <input>halfFFTtempX</input>
      <input>halfFFTtempY</input>
      <output>fft</output>
    </formula>
    <max>
      <input as="y" clear="false">fft</input>
      <input as="x" clear="false">halfFrequency</input>
      <output as="position" clear="false">f0</output>
    </max>
    <divide>
      <input clear="false">f0</input>
      <input type="value">440</input>
      <output>ratio</output>
    </divide>
    <log>
      <input type="value">2</input>
      <output>log2</output>
    </log>
    <log>
      <input>ratio</input>
      <output>logRatio</output>
    </log>
    <divide>
      <input>logRatio</input>
      <input clear="false">log2</input>
      <output>log2Ratio</output>
    </divide>
    <multiply>
      <input>log2Ratio</input>
      <input type="value">1200</input>
      <output>cents</output>
    </multiply>
    <divide>
      <input clear="false">cents</input>
      <input type="value">100</input>
      <output>semitones</output>
    </divide>
    <round>
      <input clear="false">semitones</input>
      <output>semitonesRound</output>
    </round>
    <subtract>
      <input clear="false">semitones</input>
      <input clear="false">semitonesRound</input>
      <output>semitonesDiff</output>
    </subtract>
    <multiply>
      <input clear="false">semitonesDiff</input>
      <input type="value">100</input>
      <output>centsDiff</output>
    </multiply>
    <divide>
      <input clear="false">actual_samples</input>
      <input type="value">2048</input>
      <output>resolutionRatio</output>
    </divide>
    <reduce averageY="true" averageX="true">
      <input clear="false" as="factor">resolutionRatio</input>
      <input clear="false" as="x">halfFrequency</input>
      <input clear="false" as="y">fft</input>
      <output as="x" clear="true">reducedf</output>
      <output as="y" clear="true">reducedfft</output>
    </reduce>
    <subrange>
      <input as="from" type="value">0</input>
      <input as="to" type="value">256</input>
      <input as="in">reducedf</input>
      <input as="in">reducedfft</input>
      <output>subf</output>
      <output>subfft</output>
    </subrange>
    <append>
      <input clear="false">timeline</input>
      <output clear="false">tmap</output>
    </append>
    <append>
      <input clear="false">subf</input>
      <output clear="false">fmap</output>
    </append>
    <append>
      <input clear="false">subfft</input>
      <output clear="false">fftmap</output>
    </append>
  </analysis>
  <export>
    <set name="FFT Spectrum">
      <data name="Frequency (Hz)">halfFrequency</data>
      <data name="Absolute Amplitude (a.u.)">fft</data>
    </set>
    <set name="Peak History">
      <data name="Time (s)">t</data>
      <data name="Peak-Frequency">f0</data>
    </set>
    <set name="Raw data">
      <data name="Time (s)">time</data>
      <data name="Recording (a.u.)">recording_subrange</data>
    </set>
  </export>
</phyphox>
